<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Pages</title>
    <style>
        .redPoint {
            color: red;
            border: 1px solid red;
            /* Th√™m ƒë∆∞·ªùng vi·ªÅn v·ªõi m√†u v√† ƒë·ªô d√†y mong mu·ªën */
            border-radius: 5px;
            font-size: 35px;
        }
    </style>
</head>

<body>
    <input type="text" id="actressName" placeholder="Nh·∫≠p t√™n n·ªØ di·ªÖn vi√™n">
    <input type="number" id="point" placeholder="ƒëi·ªÉm" min="1" max="10">

    <button id="saveButton">L∆∞u</button>
    <input type="text" id="weburl" placeholder="Nh·∫≠p ƒë∆∞·ªùng d·∫´n b·∫°n mong mu·ªën" value="https://javtiful.com/actress/">
    <button id="openPagesButton">M·ªü trang t·ªïng</button>
    <button id="openPagesButton1">M·ªü trang1</button>

    <button id="openPagesButton2">M·ªü trang2</button>

    <button id="openPagesButton3">M·ªü trang3</button>
    <button id="refresh">refresh</button>
    <button id="sort">sort</button>








    <div id="actressList"></div> <!-- Th√™m m·ªôt ph·∫ßn t·ª≠ ƒë·ªÉ ch·ª©a danh s√°ch n·ªØ di·ªÖn vi√™n -->

    <script>
        function openPage(url) {
            window.open(url, "_blank"); // M·ªü trang web trong c·ª≠a s·ªï m·ªõi
        }
        document.getElementById("sort").addEventListener("click", function () {
            sortActressesByPoint();
        });

        function sortActressesByPoint() {
            fetch("https://62fbae6be4bcaf53518af2ed.mockapi.io/api/actress")
                .then(response => response.json())
                .then(data => {
                    data.sort((a, b) => b.point - a.point); // S·∫Øp x·∫øp theo ƒëi·ªÉm gi·∫£m d·∫ßn
                    updateActressList(data); // C·∫≠p nh·∫≠t danh s√°ch sau khi ƒë√£ s·∫Øp x·∫øp
                })
                .catch(error => console.error("L·ªói khi l·∫•y d·ªØ li·ªáu t·ª´ API:", error));
        }

        function updateActressList(data) {
            var actressList = document.getElementById("actressList");
            actressList.innerHTML = ""; // X√≥a danh s√°ch hi·ªán t·∫°i
            data.forEach((actress, index) => {
                var listItem = document.createElement('div');
                var actressIndex = index + 1;
                listItem.textContent = actressIndex + ". " + actress.name;
                var deleteButton = document.createElement('button');
                var searchValue = document.createElement('button');
                var pointSpan = document.createElement("span");
                var editButton = document.createElement('button'); // T·∫°o n√∫t "Edit" m·ªõi
                listItem.appendChild(editButton); // Th√™m n√∫t "Edit" v√†o m·ªói m·ª•c danh s√°ch
                editButton.textContent = "Edit1"; // ƒê·∫∑t vƒÉn b·∫£n cho n√∫t "Edit"
                pointSpan.textContent = actress.point;
                pointSpan.classList.add("redPoint");
                searchValue.textContent = "search1";
                editButton.addEventListener('click', async function () {
                    console.log("üöÄ ~ editButton.addEventListener ~ actress:", actress);
                    console.log("üöÄ ~ editButton.addEventListener ~ actress.id:", actress.id);

                    // G·ªçi h√†m ƒë·ªÉ c·∫≠p nh·∫≠t ƒëi·ªÉm c·ªßa di·ªÖn vi√™n
                    await updateActressPoint(actress);
                });

                deleteButton.textContent = "X√≥a1";
                deleteButton.addEventListener('click', function () {
                    deleteActress(actress.id);
                    listItem.remove();
                });

                editButton.addEventListener('click', function () { })



                searchValue.addEventListener('click', function () {
                    var url = document.getElementById("weburl").value;
                    var actressName = actress.name.replace(/\s+/g, '-');
                    openPage(url + actressName)
                });
                listItem.appendChild(deleteButton);
                listItem.appendChild(searchValue);
                listItem.appendChild(pointSpan);
                actressList.appendChild(listItem);
            });
        }



        document.getElementById("refresh").addEventListener("click", function () {
            fetch("https://62fbae6be4bcaf53518af2ed.mockapi.io/api/actress")
                .then(response => response.json())
                .then(data => {
                    console.log("üöÄ ~ data:", data);

                    let existingNames = {};

                    for (let item of data) {
                        let nameLowerCase = item.name.toLowerCase();
                        if (!existingNames[nameLowerCase]) {
                            existingNames[nameLowerCase] = true;
                        } else {
                            // X√≥a d·ªØ li·ªáu tr√πng l·∫∑p t·ª´ API
                            fetch(`https://62fbae6be4bcaf53518af2ed.mockapi.io/api/actress/${item.id}`, {
                                method: 'DELETE'
                            })
                                .then(response => {
                                    if (response.ok) {
                                        console.log(`ƒê√£ x√≥a d·ªØ li·ªáu tr√πng l·∫∑p v·ªõi ID ${item.id} th√†nh c√¥ng.`);
                                        location.reload();
                                    } else {
                                        throw new Error(`Kh√¥ng th·ªÉ x√≥a d·ªØ li·ªáu tr√πng l·∫∑p v·ªõi ID ${item.id}.`);
                                    }
                                })
                                .catch(error => {
                                    console.error('ƒê√£ x·∫£y ra l·ªói:', error);
                                });
                        }
                    }
                })
                .catch(error => {
                    console.error('ƒê√£ x·∫£y ra l·ªói khi t·∫£i d·ªØ li·ªáu:', error);
                });
        });


        // L·∫Øng nghe s·ª± ki·ªán click tr√™n n√∫t "L∆∞u"
        document.getElementById("saveButton").addEventListener("click", function () {
            var actressName = document.getElementById("actressName").value;
            var actressPoint = document.getElementById("point").value;

            saveToApi(actressName, actressPoint);
        });

        // H√†m ƒë·ªÉ l∆∞u d·ªØ li·ªáu l√™n API
        function saveToApi(name, point) {
            fetch("https://62fbae6be4bcaf53518af2ed.mockapi.io/api/actress", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    name: name,
                    point: point
                })
            })
                .then(response => response.json())
                .then(data => {
                    console.log("D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u l√™n API:", data);
                    location.reload(); // Reload l·∫°i trang sau khi l∆∞u d·ªØ li·ªáu
                })
                .catch(error => console.error("L·ªói khi l∆∞u d·ªØ li·ªáu:", error));
        }


        function deleteActress(id) {
            fetch(`https://62fbae6be4bcaf53518af2ed.mockapi.io/api/actress/${id}`, {
                method: 'DELETE',
            })
                .then(response => response.json())
                .then(data => console.log("ƒê√£ x√≥a:", data))
                .catch(error => console.error("L·ªói khi x√≥a:", error));
        }

        // L·∫Øng nghe s·ª± ki·ªán khi t√†i li·ªáu ƒë√£ ƒë∆∞·ª£c t·∫£i
        document.addEventListener("DOMContentLoaded", function () {
            // L·∫•y d·ªØ li·ªáu t·ª´ API v√† hi·ªÉn th·ªã t√™n n·ªØ di·ªÖn vi√™n
            fetch("https://62fbae6be4bcaf53518af2ed.mockapi.io/api/actress")
                .then(response => response.json())
                .then(data => {
                    var actressList = document.getElementById("actressList");
                    data.forEach((actress, index) => { // Th√™m index v√†o forEach
                        var listItem = document.createElement('div');

                        var actressIndex = index + 1; // Ch·ªâ s·ªë b·∫Øt ƒë·∫ßu t·ª´ 1
                        listItem.textContent = actressIndex + ". " + actress.name; // Hi·ªÉn th·ªã ch·ªâ s·ªë v√† t√™n n·ªØ di·ªÖn vi√™n
                        var deleteButton = document.createElement('button');
                        var searchValue = document.createElement('button');
                        var pointSpan = document.createElement("span");
                        pointSpan.textContent = actress.point;
                        pointSpan.classList.add("redPoint"); // Th√™m class ƒë·ªÉ √°p d·ª•ng CSS
                        listItem.appendChild(pointSpan);
                        searchValue.textContent = "search";

                        deleteButton.textContent = "X√≥a2";
                        var editButton = document.createElement('button'); // T·∫°o n√∫t "Edit" m·ªõi
                        listItem.appendChild(editButton); // Th√™m n√∫t "Edit" v√†o m·ªói m·ª•c danh s√°ch
                        editButton.textContent = "Edit2"; // ƒê·∫∑t vƒÉn b·∫£n cho n√∫t "Edit"

                        editButton.addEventListener('click', async function () {
                            console.log("üöÄ ~ editButton.addEventListener ~ actress:", actress);
                            console.log("üöÄ ~ editButton.addEventListener ~ actress.id:", actress.id);

                            // G·ªçi h√†m ƒë·ªÉ c·∫≠p nh·∫≠t ƒëi·ªÉm c·ªßa di·ªÖn vi√™n
                            await updateActressPoint(actress);
                        });



                        deleteButton.addEventListener('click', function () {
                            deleteActress(actress.id);
                            listItem.remove(); // X√≥a ph·∫ßn t·ª≠ div hi·ªán t·∫°i khi nh·∫•n n√∫t x√≥a
                        });
                        searchValue.addEventListener('click', function () {
                            var url = document.getElementById("weburl").value;

                            console.log('1111111111111')
                            console.log('actress.name:', actress.name);
                            var actressName = actress.name.replace(/\s+/g, '-');
                            console.log("üöÄ ~ url:", url)
                            openPage(url + actressName)
                        })
                        listItem.appendChild(deleteButton);
                        listItem.appendChild(searchValue);
                        actressList.appendChild(listItem);
                    });
                    // H√†m ƒë·ªÉ c·∫≠p nh·∫≠t ƒëi·ªÉm c·ªßa di·ªÖn vi√™n th√¥ng qua API
                    async function updateActressPoint(actress) {
                        // Prompt ng∆∞·ªùi d√πng ƒë·ªÉ nh·∫≠p d·ªØ li·ªáu m·ªõi cho ƒëi·ªÉm
                        const newPoint = prompt(`Ch·ªânh l·∫°i ƒëi·ªÉm Point c·ªßa actress: ${actress.point}`);

                        // Ki·ªÉm tra xem ng∆∞·ªùi d√πng ƒë√£ nh·∫≠p d·ªØ li·ªáu m·ªõi hay kh√¥ng v√† x√°c nh·∫≠n th·ª±c hi·ªán c·∫≠p nh·∫≠t
                        if (newPoint !== null) {
                            try {
                                // G·ª≠i y√™u c·∫ßu PUT ƒë·∫øn API ƒë·ªÉ c·∫≠p nh·∫≠t d·ªØ li·ªáu
                                const response = await fetch(`https://62fbae6be4bcaf53518af2ed.mockapi.io/api/actress/${actress.id}`, {
                                    method: 'PUT',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({ point: newPoint })
                                });

                                // Ki·ªÉm tra xem y√™u c·∫ßu ƒë√£ th√†nh c√¥ng hay kh√¥ng
                                if (response.ok) {
                                    console.log('D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t th√†nh c√¥ng.');
                                    location.reload();
                                    // C·∫≠p nh·∫≠t d·ªØ li·ªáu tr√™n giao di·ªán n·∫øu c·∫ßn thi·∫øt
                                } else {
                                    console.error('L·ªói khi c·∫≠p nh·∫≠t d·ªØ li·ªáu:', response.statusText);
                                }
                            } catch (error) {
                                console.error('L·ªói:', error.message);
                            }
                        }
                    }

                    // S·ª≠ d·ª•ng h√†m ƒë·ªÉ c·∫≠p nh·∫≠t ƒëi·ªÉm c·ªßa di·ªÖn vi√™n khi n√∫t ch·ªânh s·ª≠a ƒë∆∞·ª£c nh·∫•n
                    // editButton.addEventListener('click', async function () {
                    //     console.log("üöÄ ~ editButton.addEventListener ~ actress:", actress);
                    //     console.log("üöÄ ~ editButton.addEventListener ~ actress.id:", actress.id);

                    //     // G·ªçi h√†m ƒë·ªÉ c·∫≠p nh·∫≠t ƒëi·ªÉm c·ªßa di·ªÖn vi√™n
                    //     await updateActressPoint(actress);
                    // });

                    console.log('Math.ceil(data.length / 3):', Math.ceil(data.length / 3));
                    console.log('Math.ceil(data.length / 1.5):', Math.ceil(data.length / 1.5));
                    document.getElementById("openPagesButton1").addEventListener("click", function () {
                        openPages(1, Math.ceil(data.length / 3)); // M·ªü trang t·ª´ 1 ƒë·∫øn 17
                    });

                    // L·∫Øng nghe s·ª± ki·ªán click tr√™n n√∫t "M·ªü trang 2"
                    document.getElementById("openPagesButton2").addEventListener("click", function () {
                        openPages(Math.ceil(data.length / 3) + 1, Math.ceil(data.length / 1.5)); // M·ªü trang t·ª´ 18 ƒë·∫øn 34
                    });

                    // L·∫Øng nghe s·ª± ki·ªán click tr√™n n√∫t "M·ªü trang 3"
                    document.getElementById("openPagesButton3").addEventListener("click", function () {
                        openPages(Math.ceil(data.length / 1.5) + 1, data.length); // M·ªü trang t·ª´ 35 ƒë·∫øn 51
                    });
                    document.getElementById("openPagesButton").addEventListener("click", function () {
                        openPages(1, data.length); // M·ªü trang t·ª´ 35 ƒë·∫øn 51
                    });
                    function openPages(startIndex, endIndex) {
                        console.log(`d·ªØ li·ªáu t·ª´ ${startIndex} ƒë·∫øn ${endIndex}   `)
                        console.log("üöÄ ~ openPages ~ startIndex:", startIndex)
                        console.log("üöÄ ~ openPages ~ endIndex:", endIndex)

                        var url = document.getElementById("weburl").value;
                        fetch("https://62fbae6be4bcaf53518af2ed.mockapi.io/api/actress")
                            .then(response => response.json())
                            .then(data => {
                                data.slice(startIndex - 1, endIndex).forEach(actress => {
                                    var actressName = actress.name.replace(/\s+/g, '-');
                                    console.log("üöÄ ~ data.slice ~ actressName:", actressName)
                                    openPage(url + actressName);
                                });
                            })
                            .catch(error => console.error("L·ªói khi l·∫•y d·ªØ li·ªáu t·ª´ API:", error));
                    }

                    // H√†m ƒë·ªÉ m·ªü m·ªôt trang web m·ªõi
                    // function openPage(url) {
                    //     window.open(url, "_blank"); // M·ªü trang web trong c·ª≠a s·ªï m·ªõi
                    // }

                })
                .catch(error => console.error("L·ªói khi l·∫•y d·ªØ li·ªáu t·ª´ API:", error));
        }
        );
    </script>

</body>

</html>